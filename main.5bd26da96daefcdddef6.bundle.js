webpackJsonp([1],{0:function(e,t,n){e.exports=n("cDNt")},cDNt:function(e,t,n){"use strict";function r(e){return g._15(0,[],null,null)}function o(e){return g._15(0,[(e()(),g._3(0,0,null,null,1,"app-root",[],null,null,null,r,S)),g._1(1,49152,null,0,v,[p,d,h],null,null)],null,null)}Object.defineProperty(t,"__esModule",{value:!0});var i,a={production:!0},c=function(){function e(){}return e}(),s=n("cqO5"),u=(n.n(s),function(){function e(e,t){this.uuid=e,this.marker=s.marker(),this.setLocation(t)}return e.prototype.getLocation=function(){return this.marker.getLatLng()},e.prototype.setLocation=function(e){this.marker.setLatLng(e)},e.prototype.getMarker=function(){return this.marker},e.prototype.getUUID=function(){return this.uuid},e}()),l=function(){function e(e,t,n){this.type=e,this.uuid=t,this.data=n}return e}();!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.MOVE=2]="MOVE",e[e.PLAYERS=3]="PLAYERS",e[e.PING=4]="PING"}(i||(i={}));var p=function(){function e(){}return e.prototype.setMapService=function(e){this.mapService=e},e.prototype.connect=function(){var e=this;return new Promise(function(t,n){e.ws&&e.close(),e.ws=new WebSocket("wss://ctfsrvr.herokuapp.com"),e.ws.onopen=function(){t(!0)},e.ws.onclose=function(t){switch(t.code){case 1e3:console.log("WebSocket: closed");break;default:setTimeout(function(){e.connect()},5e3)}},e.handleMessages()})},e.prototype.close=function(){this.ws&&this.ws.close()},e.prototype.sendMessage=function(e){this.ws&&1===this.ws.readyState&&this.ws.send(JSON.stringify(e))},e.prototype.handleMessages=function(){var e=this;this.ws.onmessage=function(t){try{var n=JSON.parse(t.data);switch(n.type){case i.CONNECT:e.mapService.addPlayer(new u(n.uuid,n.data));break;case i.PLAYERS:for(var r=0,o=n.data;r<o.length;r++){var a=o[r];e.mapService.addPlayer(new u(a.uuid,a.location))}break;case i.MOVE:e.mapService.movePlayer(e.mapService.getPlayer(n.uuid),{lat:n.data.lat,lng:n.data.lng});break;case i.DISCONNECT:e.mapService.removePlayer(n.uuid)}}catch(e){}}},e.ctorParameters=function(){return[]},e}(),d=function(){function e(){}return e.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e.ctorParameters=function(){return[]},e}(),y=n("cqO5"),f=(n.n(y),n("XKz0")),h=function(){function e(e){var t=this;this.http=e,this.players=[],this.map=y.map("map"),this.http.get("assets/settings.json").subscribe(function(e){t.map.setView(e.view,19),y.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(t.map),t.playfield=y.polygon(e.playfield,{color:"green",dashArray:"10 10",fillOpacity:0}).addTo(t.map);y.circle(e.red,{color:"red",dashArray:"10 10",fillOpacity:0,radius:40}).addTo(t.map),y.circle(e.blue,{color:"blue",dashArray:"10 10",fillOpacity:0,radius:40}).addTo(t.map)})}return e.prototype.getPlayfield=function(){return this.playfield},e.prototype.addPlayer=function(e){this.players.filter(function(t){return t.uuid===e.uuid}).length||(this.players.push(e),e.getMarker().addTo(this.map))},e.prototype.removePlayer=function(e){var t=this.players.filter(function(t){return t.uuid===e})[0];t&&(this.players.splice(this.players.indexOf(t),1),this.map.removeLayer(t.getMarker()))},e.prototype.getPlayer=function(e){return this.players.filter(function(t){return t.uuid===e})[0]},e.prototype.movePlayer=function(e,t){return!!this.isInsidePolygon(t,this.getPlayfield())&&(e.setLocation(t),!0)},e.prototype.isInsidePolygon=function(e,t){for(var n=t.getLatLngs()[0],r=e.lat,o=e.lng,i=0,a=n.length-1;i<n.length;a=i++){var c=n[i].lat,s=n[i].lng,u=n[a].lat,l=n[a].lng;if(s>o!=l>o&&r<(u-c)*(o-s)/(l-s)+c)return!0}return!1},e.prototype.setPlayer=function(e){this.player=e,this.addPlayer(this.player)},e.ctorParameters=function(){return[{type:f.c}]},e}(),m=n("cqO5"),v=(n.n(m),function(){function e(e,t,n){var r=this;this.socketService=e,this.commonService=t,this.mapService=n,this.socketService.setMapService(this.mapService),this.socketService.connect().then(function(e){e&&(r.player=new u(r.commonService.uuid(),m.latLng(60.204900026838345,24.967675209045407)),r.mapService.setPlayer(r.player),r.socketService.sendMessage(new l(i.CONNECT,r.player.getUUID(),r.player.getLocation())),r.keyListener())}),window.addEventListener("beforeunload",function(e){r.socketService.sendMessage(new l(i.DISCONNECT,r.player.getUUID()))})}return e.prototype.move=function(e,t){var n=this.player.getLocation();this.mapService.movePlayer(this.player,m.latLng(n.lat+e/2e4,n.lng+t/1e4))&&this.socketService.sendMessage(new l(i.MOVE,this.player.getUUID(),this.player.getLocation()))},e.prototype.keyListener=function(){var e=this,t={65:!1,87:!1,68:!1,83:!1};$(document).keydown(function(n){n.keyCode in t&&(t[n.keyCode]=!0,t[87]&&t[65]?e.move(1,-1):t[87]&&t[68]?e.move(1,1):t[83]&&t[68]?e.move(-1,1):t[83]&&t[65]?e.move(-1,-1):t[65]?e.move(0,-1):t[87]?e.move(1,0):t[68]?e.move(0,1):t[83]&&e.move(-1,0))}).keyup(function(e){e.keyCode in t&&(t[e.keyCode]=!1)})},e.ctorParameters=function(){return[{type:p},{type:d},{type:h}]},e}()),_=[""],g=n("/oeL"),x=[_],S=g._0({encapsulation:0,styles:x,data:{}}),k=g.Y("app-root",v,o,{},{},[]),w=n("/oeL"),b=n("qbdv"),P=n("fc+i"),L=n("XKz0"),O=w.Z(c,[v],function(e){return w._12([w._13(512,w.i,w.W,[[8,[k]],[3,w.i],w.x]),w._13(5120,w.v,w._11,[[3,w.v]]),w._13(4608,b.d,b.c,[w.v]),w._13(4608,w.h,w.h,[]),w._13(5120,w.a,w._4,[]),w._13(5120,w.t,w._9,[]),w._13(5120,w.u,w._10,[]),w._13(4608,P.b,P.s,[b.b]),w._13(6144,w.H,null,[P.b]),w._13(4608,P.e,P.f,[]),w._13(5120,P.c,function(e,t,n,r){return[new P.k(e),new P.o(t),new P.n(n,r)]},[b.b,b.b,b.b,P.e]),w._13(4608,P.d,P.d,[P.c,w.z]),w._13(135680,P.m,P.m,[b.b]),w._13(4608,P.l,P.l,[P.d,P.m]),w._13(6144,w.F,null,[P.l]),w._13(6144,P.p,null,[P.m]),w._13(4608,w.L,w.L,[w.z]),w._13(4608,P.g,P.g,[b.b]),w._13(4608,P.i,P.i,[b.b]),w._13(4608,L.h,L.m,[b.b,w.B,L.k]),w._13(4608,L.n,L.n,[L.h,L.l]),w._13(5120,L.a,function(e){return[e]},[L.n]),w._13(4608,L.j,L.j,[]),w._13(6144,L.i,null,[L.j]),w._13(4608,L.g,L.g,[L.i]),w._13(6144,L.b,null,[L.g]),w._13(5120,L.f,L.o,[L.b,[2,L.a]]),w._13(4608,L.c,L.c,[L.f]),w._13(4608,p,p,[]),w._13(4608,d,d,[]),w._13(4608,h,h,[L.c]),w._13(512,b.a,b.a,[]),w._13(1024,w.l,P.q,[]),w._13(1024,w.b,function(e,t){return[P.r(e,t)]},[[2,P.h],[2,w.y]]),w._13(512,w.c,w.c,[[2,w.b]]),w._13(131584,w._2,w._2,[w.z,w.X,w.r,w.l,w.i,w.c]),w._13(2048,w.e,null,[w._2]),w._13(512,w.d,w.d,[w.e]),w._13(512,P.a,P.a,[[3,P.a]]),w._13(512,L.e,L.e,[]),w._13(512,L.d,L.d,[]),w._13(512,c,c,[]),w._13(256,L.k,"XSRF-TOKEN",[]),w._13(256,L.l,"X-XSRF-TOKEN",[])])}),N=n("/oeL"),C=n("fc+i");a.production&&Object(N.R)(),Object(C.j)().bootstrapModuleFactory(O)},gFIY:function(e,t){function n(e){return new Promise(function(t,n){n(new Error("Cannot find module '"+e+"'."))})}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="gFIY"}},[0]);